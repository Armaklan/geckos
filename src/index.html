<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
    <head>
      <title>Geckos - Editing Cards since ...</title>
        <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
        <link rel="stylesheet" type="text/css" href="css/styles.css"></link>
    </head>
<body>
  <div id="wrapper">
    <div class="vspace"></div>
    <div class="main-menu">
      <ul>
          <li><a rel="documentation" href="#">Documentation</a></li>
          <li><a href="https://github.com/Gulix/geckos">Github Page</a></li>
      </ul>
    </div>

    <div class="clear"></div>

    <div class="sticker fullWidth">
        <div class="stickerHeading "><h1>Cards List</h1></div>
        <div class="choice-buttons">
          <input type='button' value="Template" data-bind="click: showTemplateSelection"></input>
          <input type='button' value="Cards'List" data-bind="click: showCardsList"></input>
        </div>
        <div class="header-content">
          <div class="cards-list" data-bind="visible: isCardsListVisible">
            <div class="list-buttons">
              <input type='button' value="Add" data-bind="click: addNewCard"></input>
              <input type='button' value="Remove" data-bind="click: removeSelectedCard"></input>
              <input type='button' value="Export" data-bind="click: exportList"></input>
              <input type='button' value="Import" data-bind="click: loadList"></input>
              <form style="display:none" id="file-load-list-form">
        			  <input type="file" id="file-load-list" name="file" class="form-control" style="display:none"
                      />
        		  </form>
            </div>
            <div class="list">
              <select size="5" data-bind="options: listCards, optionsText: 'cardName', value: editableCard">

              </select>
            </div>
          </div>
          <div class="template-selection" data-bind="visible: isTemplateSelectionVisible">
            <!-- ko with: cardTemplate -->
            <div class="list-buttons">
              <input type='button' value="Reset" data-bind="click: resetTemplate"></input>
              <input type='button' value="Set" data-bind="click: setTemplate"></input>
              <input type='button' value="Save" data-bind="click: saveTemplate"></input>
              <input type='button' value="Load" data-bind="click: loadTemplate"></input>
              <form style="display:none" id="file-load-template-form">
                <input type="file" id="file-load-template" name="file" class="form-control" style="display:none"
                      />
              </form>
            </div>
            <div class="template-text">
              <textarea rows="6" data-bind="value: editableTemplate"></textarea>
            </div>
            <!-- /ko -->
          </div>
        </div>
        <div class="clear"></div>
    </div>

    <div class="floatLeft">
      <div class="sticker" style="width: 380px" data-bind="with: editableCard">
          <div class="stickerHeading"><h1>Card Details</h1></div>
          Here are the defining fields to edit the card
          <div data-bind="foreach: fields">
            <div data-bind="if: isInputText()">
              <span data-bind="text: label"></span><input type="text" data-bind="value: textValue"></input>
            </div>
            <div data-bind="if: isOptions()">
              <span data-bind="text: label"></span>
              <select data-bind="options: options, optionsText: 'text', value: selectedOption"></select>
            </div>
            <div data-bind="if: isImage()">
              <span data-bind="text: label"></span>
              <input type="file" data-bind="event: { change: uploadImage($element.files[0])}"></input>
            </div>
            <div data-bind="if: isCheckbox()">
              <label>
                <input type='checkbox' data-bind='checked: checkedValue'></input>
                <span data-bind="text: label"></span>
              </label>
            </div>
          </div>
      </div>
    </div>

    <div class="sticker floatRight" style="width:494px">
        <div class="stickerHeading"><h1>Card View</h1></div>
        <canvas id="c" data-bind="fabric: generatedTemplate" ></canvas>
    </div>

</div>
    <script src="http://code.jquery.com/jquery.js"></script>
    <script src="lib/fabric.min.js"></script>
    <script src="lib/knockout-3.4.0.js"></script>
    <script src="lib/FileSaver.min.js"></script>

    <script src="js/utils.js"></script>
    <script src="js/fabricHandler.js"></script>
    <!-- ViewModels -->
    <script src="viewModels/cardTemplateVM.js"></script>
    <script src="viewModels/cardVM.js"></script>
    <script src="viewModels/editableFieldVM.js"></script>
    <script src="viewModels/engineVM.js"></script>


    <script>
    var jsonTemplate = {
      "fields": [
        { "name": "name", "label": "Name :", "default": "Captain Wolf"},
        { "name": "brawl", "label": "Brawl :", "default": "3d10"},
        { "name": "shoot", "label": "Shoot :", "default": "3d10"},
        { "name": "dodge", "label": "Dodge :", "default": "2d8"},
        { "name": "might", "label": "Might :", "default": "3d10"},
        { "name": "finesse", "label": "Finesse :", "default": "2d8"},
        { "name": "cunning", "label": "Cunning :", "default": "3d10"},
        { "name": "description", "label": "Description :", "default": "..."},
        {
          "name": "characterType", "label": "Type :", "type": "options", "default": "leader",
          "options" : [
            { "option" : "leader", "text": "Leader" },
            { "option" : "sidekick", "text": "Sidekick" },
            { "option" : "ally", "text": "Ally" },
            { "option" : "follower", "text": "Follower" },
            { "option" : "terror", "text": "Terror" },
            { "option" : "gang", "text": "Gang" }
          ]
        },
        { "name": "portray", "label": "Miniature's image :", "type": "image"},
        { "name": "isHealthDisplayed", "label": "Health bar visible ?", "type" : "checkbox", "default": true}
      ],
      "canvasFields": [
        {"type":"rect", "width": 350, "height":495, "fill":"#CAAB7F"},
        {"type":"text","text":"$characterType", "fontSize": 22},
        {"type":"text","text":"$name", "fontSize": 22, "fontWeight": "bold", "left": 80},
        {"type":"rect", "width": 170, "height":106, "left":165, "top":37, "fill":"#E07B4F", "stroke":"#000000"},
        {"type":"rect", "width": 170, "height":106, "left":165, "top":150, "fill":"#ACA497", "stroke":"#000000"},
        {"type":"text","text":"Brawl", "fontSize": 22, "fontWeight": "bold", "left": 175, "top": 40},
        {"type":"text","text":"Shoot", "fontSize": 22, "fontWeight": "bold", "left": 175, "top": 75},
        {"type":"text","text":"Dodge", "fontSize": 22, "fontWeight": "bold", "left": 175, "top": 110},
        {"type":"text","text":"Might", "fontSize": 22, "fontWeight": "bold", "left": 175, "top": 153},
        {"type":"text","text":"Finesse", "fontSize": 22, "fontWeight": "bold", "left": 175, "top": 188},
        {"type":"text","text":"Cunning", "fontSize": 22, "fontWeight": "bold", "left": 175, "top": 223},
        {"type":"text","text":"$brawl", "fontSize": 22, "fontWeight": "bold", "left": 270, "top": 40},
        {"type":"text","text":"$shoot", "fontSize": 22, "fontWeight": "bold", "left": 270, "top": 75},
        {"type":"text","text":"$dodge", "fontSize": 22, "fontWeight": "bold", "left": 270, "top": 110},
        {"type":"text","text":"$might", "fontSize": 22, "fontWeight": "bold", "left": 270, "top": 153},
        {"type":"text","text":"$finesse", "fontSize": 22, "fontWeight": "bold", "left": 270, "top": 188},
        {"type":"text","text":"$cunning", "fontSize": 22, "fontWeight": "bold", "left": 270, "top": 223},
        {"type":"image","left":5, "width":150, "top":40 ,"height":300, "src": "$portray"},
        {"type":"rect", "width": 330, "height":40, "left":5, "top":450, "fill":"#B1E29E", "stroke":"#000000", "visible": "?isHealthDisplayed"},
      ],
      "canvasBackground": "#CAAB7F",
      "canvasWidth": 340,
      "canvasHeight": 495
     };
    var template = new cardTemplateVM(jsonTemplate);
    var engineVM = new engineVM(template);
    ko.applyBindings(engineVM);

    $("#file-load-list").change(function (evt) {

       if (evt.target.files.length == 1)
       {
         var file = evt.target.files[0];
         var reader = new FileReader();

         reader.onload = function (reader) {
           var data = JSON.parse(this.result);
           engineVM.importList(data);
         };

         reader.readAsText(file);

         // Reset file input
         $("#file-load-list-form")[0].reset();
       }
   });

   $("#file-load-template").change(function (evt) {

      if (evt.target.files.length == 1)
      {
        var file = evt.target.files[0];
        var reader = new FileReader();

        reader.onload = function (reader) {
          var data = this.result;
          engineVM.cardTemplate().importTemplate(data);
        };

        reader.readAsText(file);

        // Reset file input
        $("#file-load-template-form")[0].reset();
      }
  });
    </script>
</body>
</html>
